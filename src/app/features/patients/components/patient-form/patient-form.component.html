<form [formGroup]="patientForm" (ngSubmit)="onSubmit()" class="patient-form">
  <!-- Personal Information Section -->
  <div class="form-section">
    <h3 class="section-title">Personal Information</h3>
    
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>First Name</mat-label>
        <input matInput formControlName="firstName" required>
        <mat-icon matPrefix>person</mat-icon>
        @if (patientForm.get('firstName')?.invalid && patientForm.get('firstName')?.touched) {
          <mat-error>{{ getErrorMessage('firstName') }}</mat-error>
        }
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Last Name</mat-label>
        <input matInput formControlName="lastName" required>
        @if (patientForm.get('lastName')?.invalid && patientForm.get('lastName')?.touched) {
          <mat-error>{{ getErrorMessage('lastName') }}</mat-error>
        }
      </mat-form-field>
    </div>
    
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Date of Birth</mat-label>
        <input 
          matInput 
          [matDatepicker]="dobPicker"
          formControlName="dateOfBirth"
          [max]="maxDate"
          [min]="minDate"
          required>
        <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
        <mat-datepicker #dobPicker></mat-datepicker>
        @if (patientForm.get('dateOfBirth')?.invalid && patientForm.get('dateOfBirth')?.touched) {
          <mat-error>{{ getErrorMessage('dateOfBirth') }}</mat-error>
        }
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Gender</mat-label>
        <mat-select formControlName="gender" required>
          @for (gender of genderOptions; track gender) {
            <mat-option [value]="gender">
              {{ gender | titlecase }}
            </mat-option>
          }
        </mat-select>
        <mat-icon matPrefix>wc</mat-icon>
        @if (patientForm.get('gender')?.invalid && patientForm.get('gender')?.touched) {
          <mat-error>{{ getErrorMessage('gender') }}</mat-error>
        }
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Blood Type</mat-label>
        <mat-select formControlName="bloodType">
          <mat-option value="">Not specified</mat-option>
          @for (bloodType of bloodTypeOptions; track bloodType) {
            <mat-option [value]="bloodType">{{ bloodType }}</mat-option>
          }
        </mat-select>
        <mat-icon matPrefix>water_drop</mat-icon>
      </mat-form-field>
    </div>
  </div>
  
  <!-- Contact Information Section -->
  <div class="form-section">
    <h3 class="section-title">Contact Information</h3>
    
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" required>
        <mat-icon matPrefix>email</mat-icon>
        @if (patientForm.get('email')?.invalid && patientForm.get('email')?.touched) {
          <mat-error>{{ getErrorMessage('email') }}</mat-error>
        }
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Phone</mat-label>
        <input matInput type="tel" formControlName="phone" required placeholder="+1-555-0123">
        <mat-icon matPrefix>phone</mat-icon>
        @if (patientForm.get('phone')?.invalid && patientForm.get('phone')?.touched) {
          <mat-error>{{ getErrorMessage('phone') }}</mat-error>
        }
      </mat-form-field>
    </div>
  </div>
  
  <!-- Address Section -->
  <div class="form-section">
    <h3 class="section-title">Address</h3>
    
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Street Address</mat-label>
      <input matInput formControlName="street" required>
      <mat-icon matPrefix>home</mat-icon>
      @if (patientForm.get('street')?.invalid && patientForm.get('street')?.touched) {
        <mat-error>{{ getErrorMessage('street') }}</mat-error>
      }
    </mat-form-field>
    
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>City</mat-label>
        <input matInput formControlName="city" required>
        @if (patientForm.get('city')?.invalid && patientForm.get('city')?.touched) {
          <mat-error>{{ getErrorMessage('city') }}</mat-error>
        }
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>State</mat-label>
        <input matInput formControlName="state" required>
        @if (patientForm.get('state')?.invalid && patientForm.get('state')?.touched) {
          <mat-error>{{ getErrorMessage('state') }}</mat-error>
        }
      </mat-form-field>
    </div>
    
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>ZIP Code</mat-label>
        <input matInput formControlName="zipCode" required>
        @if (patientForm.get('zipCode')?.invalid && patientForm.get('zipCode')?.touched) {
          <mat-error>{{ getErrorMessage('zipCode') }}</mat-error>
        }
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Country</mat-label>
        <input matInput formControlName="country" required>
        @if (patientForm.get('country')?.invalid && patientForm.get('country')?.touched) {
          <mat-error>{{ getErrorMessage('country') }}</mat-error>
        }
      </mat-form-field>
    </div>
  </div>
  
  <!-- Emergency Contact Section -->
  <div class="form-section">
    <h3 class="section-title">Emergency Contact</h3>
    
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Contact Name</mat-label>
      <input matInput formControlName="emergencyContactName" required>
      <mat-icon matPrefix>contact_emergency</mat-icon>
      @if (patientForm.get('emergencyContactName')?.invalid && patientForm.get('emergencyContactName')?.touched) {
        <mat-error>{{ getErrorMessage('emergencyContactName') }}</mat-error>
      }
    </mat-form-field>
    
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Relationship</mat-label>
        <input matInput formControlName="emergencyContactRelationship" required placeholder="e.g., Spouse, Parent, Sibling">
        @if (patientForm.get('emergencyContactRelationship')?.invalid && patientForm.get('emergencyContactRelationship')?.touched) {
          <mat-error>{{ getErrorMessage('emergencyContactRelationship') }}</mat-error>
        }
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Contact Phone</mat-label>
        <input matInput type="tel" formControlName="emergencyContactPhone" required placeholder="+1-555-0123">
        <mat-icon matPrefix>phone</mat-icon>
        @if (patientForm.get('emergencyContactPhone')?.invalid && patientForm.get('emergencyContactPhone')?.touched) {
          <mat-error>{{ getErrorMessage('emergencyContactPhone') }}</mat-error>
        }
      </mat-form-field>
    </div>
  </div>
  
  <!-- Medical Information Section -->
  <div class="form-section">
    <h3 class="section-title">Medical Information</h3>
    
    <!-- Allergies -->
    <div class="chips-section">
      <label class="chips-label">Allergies</label>
      <div class="chips-input-group">
        <mat-form-field appearance="outline" class="chip-input">
          <mat-label>Add allergy</mat-label>
          <input 
            matInput 
            [value]="allergyInput()"
            (input)="allergyInput.set($any($event.target).value)"
            (keyup.enter)="addAllergy()"
            placeholder="e.g., Penicillin, Peanuts">
        </mat-form-field>
        <button 
          mat-mini-fab 
          color="primary"
          type="button"
          (click)="addAllergy()"
          [disabled]="!allergyInput().trim()">
          <mat-icon>add</mat-icon>
        </button>
      </div>
      
      @if (allergies().length > 0) {
        <mat-chip-set class="chips-list">
          @for (allergy of allergies(); track allergy) {
            <mat-chip [removable]="true" (removed)="removeAllergy(allergy)">
              {{ allergy }}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
          }
        </mat-chip-set>
      } @else {
        <p class="no-items">No allergies recorded</p>
      }
    </div>
    
    <!-- Chronic Conditions -->
    <div class="chips-section">
      <label class="chips-label">Chronic Conditions</label>
      <div class="chips-input-group">
        <mat-form-field appearance="outline" class="chip-input">
          <mat-label>Add condition</mat-label>
          <input 
            matInput 
            [value]="conditionInput()"
            (input)="conditionInput.set($any($event.target).value)"
            (keyup.enter)="addCondition()"
            placeholder="e.g., Diabetes, Hypertension">
        </mat-form-field>
        <button 
          mat-mini-fab 
          color="primary"
          type="button"
          (click)="addCondition()"
          [disabled]="!conditionInput().trim()">
          <mat-icon>add</mat-icon>
        </button>
      </div>
      
      @if (chronicConditions().length > 0) {
        <mat-chip-set class="chips-list">
          @for (condition of chronicConditions(); track condition) {
            <mat-chip [removable]="true" (removed)="removeCondition(condition)">
              {{ condition }}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
          }
        </mat-chip-set>
      } @else {
        <p class="no-items">No chronic conditions recorded</p>
      }
    </div>
  </div>
</form>
